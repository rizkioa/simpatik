{% extends "front-end/base.html" %}
{% load i18n admin_static staticfiles widgets %}
{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'scripts/js/vendor/chosen/chosen.min.css' %}">
  <link rel="stylesheet" href="{% static 'scripts/js/vendor/toastr/toastr.min.css' %}">
  <link rel="stylesheet" href="{% static 'scripts/js/vendor/loadmask/jquery.loadmask.css' %}">
  <link rel="stylesheet" href="{% static 'scripts/js/vendor/datetimepicker/css/bootstrap-datetimepicker.min.css'  %}">
  <script src="{% static 'scripts/js/vendor/alert/sweetalert-dev.js' %}"></script>
  <link rel="stylesheet" href="{% static 'scripts/js/vendor/alert/sweetalert.css' %}">
  {% block customstyle %}
    <style type="text/css">
      @media only screen and (max-width: 1280px){
        .hidden_title{
           /*display: none !important;*/
           font-size: 10px;
        }
      }
      @media only screen and (max-width: 844px){
        .hidden_title{
          /*display: block !important;*/
          font-size: 12px;
        }
      }
      @media only screen and (max-width: 986px){
        .hidden_title{
           display: none !important;
           /*font-size: 10px;*/
        }
        .tab-wizard .nav-tabs > li.active > a, .tab-wizard .nav-tabs > li.active > a:hover {
          padding-bottom: 24px
        }
        .tab-wizard .nav-tabs > li.active ~ li > a, .tab-wizard .nav-tabs > li.active ~ li > a:hover {
          padding-bottom: 24px;
        }
      }
      @media only screen and (max-width: 767px){
        .hidden_title{
          display: block !important;
          /*font-size: 12px;*/
        }
      }
      hr.style14 { 
        border: 0; 
        height: 1px; 
        background-image: -webkit-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
        background-image: -moz-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
        background-image: -ms-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
        background-image: -o-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0); 
      }
    </style>
  {% endblock %}
{% endblock %}
{% block section %}
<div class="pageheader">
  {% block pageheader %}
      
  {% endblock %}
</div>
  
<div id="rootwizard" class="tab-container tab-wizard">
  {% block rootwizard %}

  {% endblock %}

  <div class="tab-content">
    {% block tab-content %}
      
    {% endblock %}

    <ul class="pager wizard">
      <li class="previous" id="previous"><a class="btn btn-default">Kembali</a></li>
      <li class="next" id="next"><a onclick="next_tab(this)" class="btn btn-default">Selanjutnya</a></li>
      <li class="next finish" style="display:none;">
      <button type="submit" class="btn btn-success pull-right" id="alert">
        <i class="fa fa-arrow-right"></i>
        <span>Selesai</span>
      </button>
      </form>
      </li>
      </form>
    </ul>
  </div>
  <br>
  <br>
  <br>
</div>
{% endblock %}

{% block extratools %}
{{ block.super }}
<script src="{% static 'scripts/js/vendor/chosen/chosen.jquery.js' %}"></script>
<script src="{% static 'scripts/js/vendor/parsley/parsley.js' %}"></script>
<script src="{% static 'scripts/js/vendor/form-wizard/jquery.bootstrap.wizard.min.js' %}"></script>
<script src="{% static 'scripts/js/vendor/toastr/toastr.min.js' %}"></script>
<script src="{% static 'scripts/js/vendor/loadmask/jquery.loadmask.js' %}"></script>
<script src="{% static 'scripts/js/vendor/filestyle/bootstrap-filestyle.min.js' %}"></script>
<script src="{% static 'scripts/js/vendor/daterangepicker/moment.js' %}"></script>
<script src="{% static 'scripts/js/vendor/datetimepicker/js/bootstrap-datetimepicker.min.js' %}"></script>
<script src="{% static 'scripts/js/vendor/validation/jquery.maskedinput.js' %}"></script>
<script>
  $(window).load(function(){
    $('#rootwizard').bootstrapWizard({
      onTabShow: function(tab, navigation, index) {
        var $total = navigation.find('li').length;
        var $current = index+1;
        if($current >= $total) {
          $('#rootwizard').find('.pager .next').hide();
          $('#rootwizard').find('.pager .finish').show();
          $('#rootwizard').find('.pager .finish').removeClass('disabled');
        } else {
          $('#rootwizard').find('.pager .next').show();
          $('#rootwizard').find('.pager .finish').hide();
        }
      },

      onNext: function(tab, navigation, index) {
        var form = $('form[name="step'+ index +'"]');
        form.parsley().validate();
        if (!form.parsley().isValid()) {
            return false;
        }
      },

      onTabClick: function(tab, navigation, index) {
        // var form = $('form[name="step'+ (index+1) +'"]');
        // form.parsley().validate();
        // if (!form.parsley().isValid()) {
        //     return false;
        // }
        return true;
      }
    });

    // document.querySelector('#alert').onclick = function(){
    //     // swal("Good job!", "You clicked the button!", "success");
    //     swal({
    //       showConfirmButton: false,
    //       type: 'success',
    //       title: 'Pendaftaran Berhasil Tersimpan',
    //       timer: 2000
    //     })
    //     window.location.replace('{% url 'admin:izin_pengajuanizin_changelist' %}');
    //   };
  });

  // Function to capitalize for string
  String.prototype.capitalize = function() {
      return this.replace(/(?:^|\s)\S/g, function(a) { return a.toUpperCase(); });
  };

  function next_tab(btn){
  var index = $('#rootwizard').bootstrapWizard('currentIndex')+1;
  var frm = $('form[name="step'+ index +'"]');
  frm.parsley().validate();
  if (frm.parsley().isValid()) {
    $( ".tab-content #tab"+index ).mask('loading')
    $(btn).attr('disabled', 'disabled')
    $.ajax({
        type: frm.attr('method'),
        url: frm.attr('action'),
        data: frm.serialize(),
        success: function (response){
          respon = $.parseJSON(response)
                $(btn).removeAttr('disabled')
                if(respon.success){
                  toastr["success"](respon.pesan)
                  // $.cookie("keys", "value"); set cookie
                  for (var i = 0; i < respon.data.length; i++){
                    var key = Object.keys(respon.data[i]); // Mencari key json
                    // console.log(key[0]);
                    if (key[0]= "status_upload") {
                      $("#npwp_perusahaan").hide(1000)

                    }else{
                      var val = respon.data[i][key[0]] // mencari value json
                      // console.log(key[0]+"_konfirmasi");
                      var id = "#"+key[0]+"_konfirmasi" // membuat variabel id untuk sett ke id masing2 komfirmasi

                      $(id).text(val);
                    }
                  }
            $( ".tab-content #tab"+index ).unmask()
            tab_index = '#rootwizard a[href="#tab'+(index+1)+'"]'
            $(tab_index).tab('show')
                }else{
                  // console.log(respon);
                  // console.log(typeof respon);
                  var a = Object.keys(respon);
                  // console.log(respon['nama_lengkap'][0]['message']);
                  // console.log(a.length);
                  for (var i = 0; i < a.length; i++){
                    // console.log(a[i]);
                    // console.log(respon[a[i]]);
                    var field = a[i].replace("_", " ").capitalize();
                    toastr["error"](field+", "+respon[a[i]][0]['message'])
                    $("#"+a[i]+"").addClass("has-error");
                    // console.log($("#"+a[i]+"").addClass("parsley-error"));
                  }
                  $( ".tab-content #tab"+index ).unmask()
                }
        },
        error: function(response){
          $( ".tab-content #tab"+index ).unmask()
          $(btn).removeAttr('disabled')
          toastr["error"]("Terjadi kesalahan pada koneksi server.")
        }
      });
    }
  };
</script>


{% endblock %}