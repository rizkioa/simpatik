{% extends "front-end/base.html" %}
{% load i18n admin_static staticfiles widgets %}
{% block extrastyle %}
{{ block.super }}
<style type="text/css">
  hr.style14 { 
    border: 0; 
    height: 1px; 
    background-image: -webkit-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
    background-image: -moz-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
    background-image: -ms-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
    background-image: -o-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0); 
  }
</style>
<link rel="stylesheet" href="{% static 'scripts/js/vendor/toastr/toastr.min.css' %}">
{% endblock %}

{% block section %}
<div class="pageheader">
  <h2>Cari Pengajuan Izin
    <span>Berikut adalah info Cari Pengajuan Izin SIMPATIK Kabupaten Kediri.</span>
  </h2>
  <div class="page-bar">
    <ul class="page-breadcrumb">
      <li>
        <a href="{% url 'frontindex' %}"><i class="fa fa-home"></i> Beranda</a>
      </li>
      <li>
        <a href="#"> Pengaduan Izin</a>
      </li>
    </ul>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <section class="tile">
      <div class="tile-body">
        <div class="row">
          <div class="col-md-6 col-md-offset-3">
            <div class="panel panel-darkgray">
              <div class="panel-header">
                <div class="row">
                  <div class="col-sm-12">
                    <h2 class="text-center">Pengaduan Izin</h2>
                    <hr class="style14">
                  </div>
                </div>
              </div>
              <div class="panel-body">
                <form method="POST" class="frm_pengaduan">
                {% csrf_token %}
                  <div class="row">
                    <div class="form-group col-md-12">
                      <label for="input01" class="col-sm-4 control-label">Nomor KTP</label>
                      <div class="col-sm-8">
                        <input type="text" required="" class="form-control" name="no_ktp">
                      </div>
                    </div>
                    <div class="form-group col-md-12">
                      <label for="input01" class="col-sm-4 control-label">Nama Lengkap</label>
                      <div class="col-sm-8">
                        <input type="text" required class="form-control" name="nama_lengkap">
                      </div>
                    </div>
                    <div class="form-group col-md-12">
                      <label for="input01" class="col-sm-4 control-label">Email</label>
                      <div class="col-sm-8">
                        <input type="text" class="form-control" name="email">
                      </div>
                    </div>
                    <div class="form-group col-md-12">
                      <label for="input01" class="col-sm-4 control-label">Nomor Telphone</label>
                      <div class="col-sm-8">
                        <input type="text"  class="form-control" name="nomor_telphone">
                      </div>
                    </div>
                    <div class="form-group col-md-12">
                      <label for="input01" class="col-sm-4 control-label">Kategori Pengajuan</label>
                      <div class="col-sm-8">
                         <select class="form-control" required="" name="kategori_pengajuan">
                            <option value>Pilih Kelompok Jenis Izin</option>
                           {% if kelompokjenisizin %}
                            {% for k in kelompokjenisizin %}
                              <option value="{{k.id}}">{{k.jenis_izin}}</option>
                            {% endfor %}
                           {% endif %}
                         </select>
                      </div>
                    </div>
                    <div class="form-group col-md-12">
                      <label for="input01" class="col-sm-4 control-label">Isi Pengaduan</label>
                      <div class="col-sm-8">
                        <textarea class="form-control" required="" name="isi_pengaduan"></textarea>
                      </div>
                    </div>
                    <div class="form-group col-md-12">
                      <div class="col-sm-12" align="center">
                        <hr class="style14">
                        <button onclick="save_pengaduan();" type="button" class="btn btn-success"><i class="fa fa-eye"></i> <span>Pengaduan</span></button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
              <div class="panel-footer">
                <p align="center"><strong>Untuk Melihat Lebih Lanjut Pengaduan Anda</strong><span class="no_ktp"></span></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
{% endblock %}

{% block extratools %}
  {{ block.super }}
  <script src='https://www.google.com/recaptcha/api.js'></script>
  <script type="text/javascript" src="{% static 'scripts/js/vendor/toastr/toastr.min.js' %}"></script>
  <script type="text/javascript">
  function save_pengaduan(){
    csrf_token = $("input[name='csrfmiddlewaretoken']").val();
    no_ktp_ = $('#id_nomor_ktp').val();
    console.log(no_ktp_)
    nama_lengkap_ = $('#id_nama_lengkap').val();
    email_ = $('#id_email').val();
    no_telp_ = $('#id_nomor_telphone').val();
    kategori_pengaduan_ = $('#id_kategori_pengaduan').val();
    isi_pengaduan_ = $('textarea[name=isi_pengaduan]').val();
    // response = $('#g-recaptcha-response').val();
    // recaptcha_challenge_field = $('input[name=recaptcha_challenge_field]').val()
    // recaptcha_response_field = $('input[name=recaptcha_response_field]').val()
    // $.ajax({
    //   type: 'POST',
    //   url: '{% url 'ajax_save_pengaduan' %}',
    //   data: { csrfmiddlewaretoken: csrf_token, no_ktp_: no_ktp_, nama_lengkap_: nama_lengkap_, email_: email_, no_telp_: no_telp_, kategori_pengaduan_:kategori_pengaduan_, isi_pengaduan_:isi_pengaduan_ },
    //     success: function (data) {
    //       respon = $.parseJSON(data)
    //         if(respon.success){
    //           toastr["success"](respon.pesan)
    //           setTimeout(function(){ 
    //             // alert("Hello");
    //             window.location.reload()

    //           }, 3000);
    //         }
    //         else{
    //           toastr["warning"](respon.pesan)
    //           // alert("error")
    //           // window.location.replace(respon.url)
    //         }
    //     }
    //     // error: function(data) {                
    //     //   toastr["error"]("Terjadi kesalahan server.")
    //     // }
    // })
    frm = $('.frm_pengaduan')
    frm.parsley().validate();
    if (frm.parsley().isValid()){
        frm.ajaxSubmit({
            method: 'POST',
            data: frm.serialize(),
            url: '{% url 'ajax_save_pengaduan' %}',
            beforeSend: function() {
              frm.mLoading();
            },
            success: function(response){
                frm.mLoading('hide');
                respon = JSON.parse(response)
                if (respon.success == true){
                  toastr["success"](respon.pesan)
                }
                else{
                  toastr["warning"](respon.pesan)
                }
            },
            error: function(){
              frm.mLoading('hide');
              toastr["error"]("Terjadi Kesalahan Server.")
            }
        });
    }
  }

  get_option_kelompokjenisizin()
  function get_option_kelompokjenisizin(){
      $.ajax({
          url : __base_url__+'/admin/izin/kelompokjenisizin/option/',
          type: "GET",
          success: function(response){
              $('.option-kelompokjenisizin').html(response)
              $('.option-kelompokjenisizin').append('<option value selected>Pilih Jenis Izin</option>')

          }
      })
  }
    
  </script>
{% endblock %}